# 전체 플로우 테스트 가이드

이 가이드는 어드민 웹과 모바일 앱을 사용한 전체 근로 계약 관리 플로우를 테스트하는 방법을 설명합니다.

## 🎯 테스트 목표

1. 어드민에서 초대 링크 발송
2. 근로자가 본인 정보 입력
3. 어드민에 정보 추가됨
4. 어드민에서 근로계약서 작성 및 발송
5. 근로자 메시지 확인, 앱 다운로드 및 근로계약서 서명 → 근로계약 체결
6. 근로자, 앱을 통해 근무기록 남기기
7. 어드민에서 근로자가 남긴 근로기록 확인

## 📋 사전 준비

### 서버 실행 확인

1. **백엔드 서버 (포트 3000)**
   ```bash
   cd apps/backend
   npm run start:dev
   ```
   확인: `http://localhost:3000/api/health`

2. **어드민 웹 (포트 5173)**
   ```bash
   cd apps/admin
   npm run dev
   ```
   확인: `http://localhost:5173`

3. **모바일 앱 (포트 5174)**
   ```bash
   cd apps/mobile
   npm run dev
   ```
   확인: `http://localhost:5174`

### 네트워크 정보

- **컴퓨터 IP 주소**: `192.168.45.78`
- **어드민 웹**: `http://192.168.45.78:5173` (모바일에서도 접속 가능)
- **모바일 앱**: `http://192.168.45.78:5174` (모바일 기기에서 접속)

### 테스트 계정

**슈퍼 관리자:**
- 이메일: `admin@ecospott.com`
- 비밀번호: `password123`

**회사 관리자:**
- 이메일: `company@ecospott.com`
- 비밀번호: `password123`
- 회사: (주)에코스팟

---

## 📱 단계별 테스트 가이드

### 1단계: 어드민에서 초대 링크 발송

**컴퓨터에서:**

1. **어드민 웹 접속**
   - 브라우저에서 `http://localhost:5173` 접속
   - 또는 모바일에서 `http://192.168.45.78:5173` 접속

2. **로그인**
   - 이메일: `admin@ecospott.com` (또는 `company@ecospott.com`)
   - 비밀번호: `password123`

3. **초대 링크 생성**
   - "계약 관리" 탭으로 이동
   - 상단의 **"초대 링크"** 버튼 클릭
   - 링크가 클립보드에 자동 복사됨

4. **모바일 링크 변환**
   - 복사된 링크에서 `localhost`를 `192.168.45.78`로 변경
   - 예시:
     - 원본: `http://localhost:5174/invite.html?invite=clx1234567890`
     - 변경: `http://192.168.45.78:5174/invite.html?invite=clx1234567890`

5. **링크 확인 (개발자 도구 콘솔)**
   ```javascript
   // 회사 ID 확인
   const user = JSON.parse(localStorage.getItem('user'));
   const companyId = user.companyId || user.company?.id;
   
   // 모바일 링크 생성
   const mobileLink = `http://192.168.45.78:5174/invite.html?invite=${companyId}`;
   console.log('📱 모바일 초대 링크:', mobileLink);
   navigator.clipboard.writeText(mobileLink);
   console.log('✅ 클립보드에 복사되었습니다!');
   ```

---

### 2단계: 근로자가 본인 정보 입력

**모바일 기기에서:**

1. **모바일 브라우저에서 링크 접속**
   - 카카오톡, 메신저, 이메일 등으로 받은 링크 클릭
   - 또는 브라우저 주소창에 직접 입력:
     ```
     http://192.168.45.78:5174/invite.html?invite={회사ID}
     ```

2. **근로자 등록 페이지 확인**
   - 회사 이름이 표시되어야 함
   - 근로자 정보 입력 폼이 나타나야 함

3. **근로자 정보 입력**
   - 이름: 예) `홍길동`
   - 전화번호: 예) `010-1234-5678`
   - 생년월일: 예) `1990-01-01`
   - 주민등록번호: 예) `900101-1234567`
   - 근무시간: 예) `주 40시간 (09:00-18:00)`
   - 임금: 예) `월 2,500,000원`
   - 계약기간: 예) `2024-01-01 ~ 2025-12-31`
   - 장애등급: 선택 (경증, 중증 등)
   - 장애유형: 예) `지체장애`
   - 장애인정일자: 예) `2015-06-10`
   - 비상연락처 이름: 예) `홍영희`
   - 비상연락처 전화번호: 예) `010-9876-5432`
   - 개인정보 수집 동의: 체크

4. **제출**
   - "등록하기" 버튼 클릭
   - 등록 완료 메시지 확인

---

### 3단계: 어드민에 정보 추가됨 확인

**컴퓨터에서 (어드민 웹):**

1. **계약 관리 탭 새로고침**
   - F5 또는 새로고침 버튼 클릭
   - 또는 페이지를 다시 열기

2. **근로자 목록 확인**
   - 방금 등록한 근로자 정보가 목록에 표시되어야 함
   - 상태: "초안" (DRAFT)

3. **근로자 정보 확인**
   - 이름, 전화번호 등 입력한 정보가 정확히 표시되는지 확인

---

### 4단계: 어드민에서 근로계약서 작성 및 발송

**컴퓨터에서 (어드민 웹):**

1. **근로자 선택**
   - 계약 관리 탭에서 방금 등록한 근로자 체크박스 선택
   - 또는 여러 명 선택 가능

2. **근로계약서 작성 버튼 클릭**
   - 상단의 "근로계약서 작성 및 발송" 버튼 클릭

3. **계약서 정보 확인**
   - 근로자 정보가 자동으로 입력되어 있는지 확인
   - 필요한 경우 수정

4. **계약서 발송**
   - "발송하기" 버튼 클릭
   - 발송 완료 메시지 확인

5. **카카오톡 알림 확인**
   - 근로자에게 카카오톡 알림이 발송됨 (개발 모드에서는 콘솔 로그)
   - 실제 카카오톡 API 설정된 경우: 근로자의 전화번호로 알림 발송

---

### 5단계: 근로자 메시지 확인, 앱 다운로드 및 근로계약서 서명

**모바일 기기에서:**

#### 5-1. 카카오톡 메시지 확인

1. **카카오톡 메시지 확인**
   - 근로자 전화번호로 등록된 카카오톡 확인
   - "계약서 확인하기" 버튼이 있는 메시지 확인

2. **링크 클릭**
   - "계약서 확인하기" 버튼 클릭
   - 또는 메시지에 있는 링크 클릭

#### 5-2. 앱 설치 (Capacitor 앱)

**옵션 A: APK 다운로드 (Android)**

1. **설치 페이지로 자동 리다이렉트**
   - 앱이 설치되어 있지 않으면 자동으로 `/download.html`로 이동

2. **APK 다운로드**
   - "Android 앱 다운로드 (APK)" 버튼 클릭
   - APK 파일 다운로드

3. **APK 설치**
   - 다운로드한 APK 파일 찾기
   - 파일 탭하여 설치
   - "알 수 없는 소스에서 설치 허용" 설정

4. **앱 실행**
   - 설치된 앱 실행
   - 계약서 링크로 자동 이동

**옵션 B: 웹 브라우저에서 진행 (빠른 테스트)**

- APK 설치 없이 웹 브라우저에서 바로 진행 가능
- `http://192.168.45.78:5174/contract/{contractId}` 직접 접속

#### 5-3. 근로계약서 확인 및 서명

1. **계약서 확인**
   - 계약서 내용 확인
   - 근로 조건, 급여, 근무시간 등 확인

2. **계약서 서명**
   - "서명하기" 버튼 클릭
   - 서명 패드에 서명
   - "제출하기" 버튼 클릭

3. **서명 완료 확인**
   - "계약 체결 완료" 메시지 확인
   - 계약서 PDF 다운로드 가능

---

### 6단계: 근로자, 앱을 통해 근무기록 남기기

**모바일 기기에서 (앱 또는 웹):**

1. **앱 실행**
   - 설치된 앱 실행
   - 또는 웹 브라우저에서 `http://192.168.45.78:5174` 접속

2. **근무기록 탭 이동**
   - 하단 또는 상단의 "근무기록" 또는 "근무현황" 탭 클릭
   - 또는 메뉴에서 "근무 기록" 선택

3. **근무기록 입력**
   - 날짜 선택
   - 출근 시간: 예) `09:00`
   - 퇴근 시간: 예) `18:00`
   - 근무 내용: 예) `일반 업무`
   - 비고: 예) `정상 근무`

4. **기록 저장**
   - "저장" 또는 "등록" 버튼 클릭
   - 저장 완료 메시지 확인

5. **여러 일자 기록 입력**
   - 다른 날짜도 선택하여 여러 근무 기록 추가

---

### 7단계: 어드민에서 근로자가 남긴 근로기록 확인

**컴퓨터에서 (어드민 웹):**

1. **근무 현황 탭 이동**
   - 어드민 웹에서 "근무 현황" 탭 클릭
   - 또는 "근로자 관리" → "근무 현황" 메뉴 선택

2. **회사 선택 (슈퍼 관리자인 경우)**
   - 드롭다운에서 해당 회사 선택

3. **근무 기록 확인**
   - 근로자 목록 확인
   - 각 근로자의 근무 기록 확인
   - 날짜별, 시간별 기록 확인

4. **근무 기록 상세 확인**
   - 특정 근로자의 근무 기록 클릭
   - 상세 정보 확인
   - 출퇴근 시간, 근무 내용 등 확인

5. **통계 확인**
   - 총 근무 시간
   - 월별 근무 기록
   - 근무 일수 등

---

## 🔧 문제 해결

### 초대 링크가 작동하지 않음

**확인 사항:**
1. 모바일 앱 서버 실행 중인지 확인
   ```bash
   curl http://192.168.45.78:5174
   ```

2. 컴퓨터와 모바일 기기가 같은 Wi-Fi 네트워크인지 확인

3. IP 주소가 변경되지 않았는지 확인
   ```bash
   ifconfig | grep "inet " | grep -v 127.0.0.1
   ```

### 근로자 정보가 어드민에 표시되지 않음

**확인 사항:**
1. 백엔드 서버 실행 중인지 확인
   ```bash
   curl http://localhost:3000/api/health
   ```

2. 어드민 웹에서 페이지 새로고침

3. 브라우저 개발자 도구 콘솔에서 오류 확인

### 계약서 링크가 작동하지 않음

**확인 사항:**
1. 계약서 ID가 올바른지 확인
2. 백엔드 API에서 계약서 조회 확인
3. 모바일 앱 서버 실행 중인지 확인

### 근무 기록이 저장되지 않음

**확인 사항:**
1. 백엔드 서버 실행 중인지 확인
2. 로그인 상태 확인 (근로자 인증 필요할 수 있음)
3. 브라우저 개발자 도구 콘솔에서 오류 확인

---

## 📱 모바일 기기 접속 링크 요약

### 초대 링크 (근로자 등록)
```
http://192.168.45.78:5174/invite.html?invite={회사ID}
```

### 계약서 링크
```
http://192.168.45.78:5174/contract/{계약서ID}
```

### 앱 설치 페이지
```
http://192.168.45.78:5174/download.html?redirect=/contract/{계약서ID}
```

### 근무 기록 페이지
```
http://192.168.45.78:5174/work-records
```

### 메인 페이지
```
http://192.168.45.78:5174/
```

---

## ✅ 테스트 체크리스트

- [ ] 1단계: 어드민에서 초대 링크 발송 완료
- [ ] 2단계: 근로자가 모바일에서 정보 입력 완료
- [ ] 3단계: 어드민에 근로자 정보 추가 확인
- [ ] 4단계: 어드민에서 근로계약서 작성 및 발송 완료
- [ ] 5단계: 근로자가 모바일에서 계약서 확인 및 서명 완료
- [ ] 6단계: 근로자가 모바일에서 근무기록 입력 완료
- [ ] 7단계: 어드민에서 근무기록 확인 완료

---

## 💡 팁

1. **테스트 계정 준비**
   - 여러 근로자 계정을 미리 등록하여 빠른 테스트 가능

2. **카카오톡 알림 테스트**
   - 개발 모드에서는 백엔드 콘솔 로그 확인
   - 실제 전화번호로 테스트하려면 카카오톡 API 설정 필요

3. **APK 설치 테스트**
   - 테스트용 디버그 APK 사용 (`./build-apk.sh debug`)
   - 빠른 재설치를 위해 이전 버전 제거 후 설치

4. **네트워크 이슈**
   - IP 주소가 자주 변경되는 경우 고정 IP 사용 고려
   - 또는 동적 DNS 서비스 활용

---

**준비 완료!** 이제 단계별로 테스트를 진행하세요! 🚀

