# 카카오톡 로그인 구현 완료 가이드

## ✅ 현재 상태

카카오톡 로그인 기능이 이미 구현되어 있습니다:
- ✅ 백엔드 API: `POST /api/employees/login-by-kakao`
- ✅ 프론트엔드 컴포넌트: `PhoneLogin.tsx`
- ✅ 카카오 JavaScript SDK 통합 완료
- ✅ 환경 변수 파일 생성 완료

## 📋 설정 완료 체크리스트

### 1. 카카오 개발자 콘솔 설정 (필수)

#### 1-1. 카카오 개발자 콘솔 접속
- URL: https://developers.kakao.com/
- 카카오 계정으로 로그인

#### 1-2. 애플리케이션 선택 또는 생성
- **내 애플리케이션** 메뉴 클릭
- 기존 앱 선택 또는 새 앱 생성

#### 1-3. JavaScript 키 확인
- **앱 설정** → **앱 키** 메뉴
- **JavaScript 키** 확인: `4fd9be15675f83e1a441b25724837d57` ✅

#### 1-4. Web 플랫폼 등록
**앱 설정** → **플랫폼** → **Web 플랫폼 등록**:
```
http://43.200.44.109:3001
```

#### 1-5. 카카오 로그인 활성화
**제품 설정** → **카카오 로그인** → **활성화 설정**:
- **카카오 로그인** 활성화 ON ✅

#### 1-6. Redirect URI 등록 (중요!)
**제품 설정** → **카카오 로그인** → **Redirect URI**:
다음 URI들을 **하나씩** 등록:

**프로덕션:**
```
http://43.200.44.109:3001
```

**개발 환경:**
```
http://localhost:5174
```

⚠️ **주의사항:**
- `http://`와 `https://`는 별도로 등록해야 합니다
- 포트 번호(`:3001`, `:5174`)를 정확히 입력해야 합니다
- 마지막에 `/` 없이 입력해야 합니다

#### 1-7. 동의 항목 설정 (필수!)
**제품 설정** → **카카오 로그인** → **동의항목**:
- **전화번호**: **필수 동의** ✅
  - 전화번호는 근로자 매칭에 필수입니다
- **카카오계정(이메일)**: 선택 (선택사항)

### 2. 환경 변수 설정 (완료 ✅)

`apps/mobile/.env` 파일이 생성되었습니다:
```env
VITE_KAKAO_JS_KEY=4fd9be15675f83e1a441b25724837d57
```

### 3. 모바일 앱 재빌드 및 배포

환경 변수를 적용하려면 앱을 재빌드해야 합니다:

```bash
# 1. 모바일 앱 빌드
cd apps/mobile
npm run build

# 2. 배포 (redeploy-mobile.sh 실행)
cd ../..
bash redeploy-mobile.sh
```

## 🔄 로그인 플로우

1. **근로자가 "카카오로 로그인" 버튼 클릭**
   - 카카오 JavaScript SDK 초기화
   - 카카오 로그인 팝업 표시

2. **카카오 계정으로 로그인**
   - 카카오 인증 완료
   - 액세스 토큰 발급

3. **백엔드로 액세스 토큰 전송**
   - `POST /api/employees/login-by-kakao`
   - 액세스 토큰을 백엔드로 전송

4. **백엔드에서 카카오 사용자 정보 조회**
   - 카카오 API 호출: `https://kapi.kakao.com/v2/user/me`
   - 카카오 ID와 전화번호 추출

5. **근로자 매칭**
   - 카카오 ID로 근로자 조회
   - 없으면 전화번호로 조회
   - 찾으면 카카오 ID 저장

6. **로그인 완료**
   - 근로자 정보 반환
   - 모바일 앱에서 로그인 상태 저장

## 🧪 테스트 방법

### 1. 개발 환경 테스트

```bash
# 1. 모바일 앱 실행
cd apps/mobile
npm run dev

# 2. 브라우저에서 접속
# http://localhost:5174

# 3. 카카오 로그인 버튼 클릭
# 4. 카카오 계정으로 로그인
# 5. 로그인 성공 확인
```

### 2. 프로덕션 환경 테스트

1. **모바일 앱 재배포**
   ```bash
   bash redeploy-mobile.sh
   ```

2. **브라우저에서 접속**
   - http://43.200.44.109:3001

3. **카카오 로그인 버튼 클릭**
   - 카카오 로그인 팝업 표시 확인
   - 카카오 계정으로 로그인
   - 로그인 성공 확인

## ⚠️ 주의사항

### 1. 근로자 등록 필수
- 카카오 로그인은 **이미 등록된 근로자만** 로그인할 수 있습니다
- 등록되지 않은 근로자는 "등록된 정보가 없습니다" 오류가 발생합니다
- 먼저 회사 초대 링크를 통해 근로자를 등록해야 합니다

### 2. 전화번호 동의 필수
- 카카오 로그인 시 **전화번호 동의가 필수**입니다
- 전화번호가 없으면 근로자 매칭이 불가능합니다
- 카카오 개발자 콘솔에서 전화번호를 필수 동의 항목으로 설정해야 합니다

### 3. Redirect URI 정확성
- Redirect URI는 정확히 일치해야 합니다
- 프로토콜(`http`/`https`), 도메인, 포트 번호 모두 정확해야 합니다
- 마지막에 `/` 없이 입력해야 합니다

## 🐛 문제 해결

### 1. "카카오 SDK가 초기화되지 않았습니다" 오류
**원인**: `VITE_KAKAO_JS_KEY`가 설정되지 않았거나 잘못된 키
**해결**:
- `apps/mobile/.env` 파일 확인
- JavaScript 키가 올바른지 확인
- 앱 재시작 또는 재빌드

### 2. "redirect_uri_mismatch" 오류
**원인**: Redirect URI가 등록되지 않았거나 잘못된 URI
**해결**:
- 카카오 개발자 콘솔에서 Redirect URI 확인
- 정확한 도메인과 포트 등록
- 프로토콜(`http`/`https`) 확인

### 3. "등록된 정보가 없습니다" 오류
**원인**: 카카오 계정의 전화번호로 등록된 근로자가 없음
**해결**:
- 먼저 회사 초대 링크를 통해 근로자 등록
- 근로자의 전화번호가 카카오 계정과 일치하는지 확인

### 4. 전화번호를 가져올 수 없음
**원인**: 카카오 로그인 동의 항목에서 전화번호 동의를 하지 않음
**해결**:
- 카카오 개발자 콘솔에서 전화번호를 필수 동의 항목으로 설정
- 사용자가 로그인 시 전화번호 동의 필요

### 5. 카카오 로그인 팝업이 안 뜸
**원인**: JavaScript 키가 설정되지 않았거나 SDK 초기화 실패
**해결**:
- `apps/mobile/.env` 파일 확인
- 브라우저 콘솔에서 오류 메시지 확인
- 모바일 앱 재시작 또는 재빌드

## 📁 관련 파일

- **프론트엔드**: `apps/mobile/src/components/PhoneLogin.tsx`
- **백엔드 API**: `apps/backend/src/employees/employees.controller.ts` (line 171-230)
- **API 클라이언트**: `packages/shared/api.ts` (line 305-312)
- **데이터베이스**: `apps/backend/prisma/schema.prisma` (kakaoId 필드)
- **환경 변수**: `apps/mobile/.env`

## 🎯 다음 단계

1. ✅ 환경 변수 파일 생성 완료
2. ⏳ 카카오 개발자 콘솔에서 Redirect URI 등록
3. ⏳ 카카오 로그인 활성화 확인
4. ⏳ 전화번호 동의 항목 필수로 설정
5. ⏳ 모바일 앱 재빌드 및 배포
6. ⏳ 카카오 로그인 테스트

---

**준비 완료!** 카카오 개발자 콘솔 설정만 완료하면 카카오 로그인 기능을 사용할 수 있습니다! 🎉
