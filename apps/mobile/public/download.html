<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì•± ì„¤ì¹˜ ì•ˆë‚´ - ê·¸ë ˆì´íŠ¸í¼ì¦</title>
  <!-- ì•± ì„¤ì¹˜ ë§í¬ ì„¤ì • (í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì • í•„ìš”) -->
  <meta name="android-apk-url" content="https://your-domain.com/downloads/labor-management.apk">
  <meta name="ios-app-store-url" content="https://apps.apple.com/app/idYOUR_APP_ID">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background: linear-gradient(135deg, #2E4F4F 0%, #1a3333 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      color: white;
    }
    .container {
      max-width: 500px;
      width: 100%;
      background: white;
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      text-align: center;
    }
    .logo {
      width: 80px;
      height: 80px;
      background: #2E4F4F;
      border-radius: 20px;
      margin: 0 auto 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: bold;
      color: white;
    }
    h1 {
      color: #1a3333;
      font-size: 1.75rem;
      margin-bottom: 0.5rem;
      font-weight: 700;
    }
    .subtitle {
      color: #666;
      font-size: 0.95rem;
      margin-bottom: 2rem;
    }
    .install-steps {
      text-align: left;
      background: #f8f9fa;
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .step {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      margin-bottom: 1.25rem;
    }
    .step:last-child {
      margin-bottom: 0;
    }
    .step-number {
      width: 28px;
      height: 28px;
      background: #2E4F4F;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 0.9rem;
      flex-shrink: 0;
    }
    .step-content {
      flex: 1;
    }
    .step-title {
      font-weight: 600;
      color: #1a3333;
      margin-bottom: 0.25rem;
      font-size: 0.95rem;
    }
    .step-description {
      color: #666;
      font-size: 0.85rem;
      line-height: 1.5;
    }
    .button-group {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: 2rem;
    }
    .btn {
      padding: 1rem 1.5rem;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1rem;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      display: block;
    }
    .btn-primary {
      background: #2E4F4F;
      color: white;
    }
    .btn-primary:hover {
      background: #1a3333;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(46, 79, 79, 0.3);
    }
    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }
    .btn-secondary:hover {
      background: #e0e0e0;
    }
    .info-box {
      background: #e8f5e9;
      border-left: 4px solid #4caf50;
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1.5rem;
      text-align: left;
    }
    .info-box p {
      color: #2e7d32;
      font-size: 0.9rem;
      line-height: 1.6;
      margin: 0;
    }
    @media (max-width: 480px) {
      .container {
        padding: 1.5rem;
      }
      h1 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">GP</div>
    <h1>ì•± ì„¤ì¹˜ ì•ˆë‚´</h1>
    <p class="subtitle">ê·¸ë ˆì´íŠ¸í¼ì¦ ê·¼ë¡œì ê³„ì•½ ê´€ë¦¬ ì•±</p>

    <div class="install-steps" id="androidSteps" style="display: none;">
      <div class="step">
        <div class="step-number">1</div>
        <div class="step-content">
          <div class="step-title">APK íŒŒì¼ ë‹¤ìš´ë¡œë“œ</div>
          <div class="step-description">ì•„ë˜ "Android ì•± ë‹¤ìš´ë¡œë“œ" ë²„íŠ¼ì„ ëˆŒëŸ¬ APK íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”.</div>
        </div>
      </div>
      <div class="step">
        <div class="step-number">2</div>
        <div class="step-content">
          <div class="step-title">ì•± ì„¤ì¹˜ í—ˆìš©</div>
          <div class="step-description">
            ë‹¤ìš´ë¡œë“œí•œ APK íŒŒì¼ì„ ì—´ê³  "ì•Œ ìˆ˜ ì—†ëŠ” ì†ŒìŠ¤ì—ì„œ ì„¤ì¹˜ í—ˆìš©"ì„ ì„ íƒí•˜ì„¸ìš”.
          </div>
        </div>
      </div>
      <div class="step">
        <div class="step-number">3</div>
        <div class="step-content">
          <div class="step-title">ì•± ì„¤ì¹˜ ë° ì‹¤í–‰</div>
          <div class="step-description">ì„¤ì¹˜ê°€ ì™„ë£Œë˜ë©´ ì•±ì„ ì‹¤í–‰í•˜ì—¬ ê³„ì•½ì„œë¥¼ í™•ì¸í•˜ì„¸ìš”.</div>
        </div>
      </div>
    </div>

    <div class="install-steps" id="iosSteps" style="display: none;">
      <div class="step">
        <div class="step-number">1</div>
        <div class="step-content">
          <div class="step-title">App Storeì—ì„œ ì„¤ì¹˜</div>
          <div class="step-description">ì•„ë˜ "App Storeì—ì„œ ì„¤ì¹˜" ë²„íŠ¼ì„ ëˆŒëŸ¬ App Storeë¡œ ì´ë™í•˜ì„¸ìš”.</div>
        </div>
      </div>
      <div class="step">
        <div class="step-number">2</div>
        <div class="step-content">
          <div class="step-title">ì•± ë‹¤ìš´ë¡œë“œ</div>
          <div class="step-description">App Storeì—ì„œ "ë‹¤ìš´ë¡œë“œ" ë˜ëŠ” "ë°›ê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì•±ì„ ì„¤ì¹˜í•˜ì„¸ìš”.</div>
        </div>
      </div>
      <div class="step">
        <div class="step-number">3</div>
        <div class="step-content">
          <div class="step-title">ì•± ì‹¤í–‰</div>
          <div class="step-description">ì„¤ì¹˜ê°€ ì™„ë£Œë˜ë©´ ì•±ì„ ì‹¤í–‰í•˜ì—¬ ê³„ì•½ì„œë¥¼ í™•ì¸í•˜ì„¸ìš”.</div>
        </div>
      </div>
    </div>

    <div class="button-group">
      <a href="/" id="appLink" class="btn btn-primary">ì•±ìœ¼ë¡œ ì´ë™í•˜ê¸°</a>
      <button class="btn btn-secondary" onclick="window.history.back()">ì´ì „ìœ¼ë¡œ</button>
    </div>

    <div class="info-box">
      <p>
        <strong>ğŸ’¡ íŒ:</strong> ì•±ì„ ì„¤ì¹˜í•˜ë©´ ë” ë¹ ë¥´ê³  í¸ë¦¬í•˜ê²Œ ê·¼ë¡œê³„ì•½ì„œë¥¼ í™•ì¸í•˜ê³  ì„œëª…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </p>
    </div>
  </div>

  <script>
    // URL íŒŒë¼ë¯¸í„°ì—ì„œ redirect ê²½ë¡œ ê°€ì ¸ì˜¤ê¸°
    const urlParams = new URLSearchParams(window.location.search);
    const redirectPath = urlParams.get('redirect') || '/';
    
    // Capacitor ì•± ì„¤ì¹˜ ì—¬ë¶€ í™•ì¸
    const isCapacitorApp = window.Capacitor !== undefined;
    const isIOS = /iphone|ipad|ipod/i.test(window.navigator.userAgent);
    const isAndroid = /android/i.test(window.navigator.userAgent);
    
    // ì´ë¯¸ Capacitor ì•±ì´ ì„¤ì¹˜ë˜ì–´ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ ì›ë˜ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    if (isCapacitorApp) {
      window.location.href = redirectPath;
    }

    // ì•± ì„¤ì¹˜ ë§í¬ ê°€ì ¸ì˜¤ê¸°
    // 1. ë©”íƒ€ íƒœê·¸ì—ì„œ ì½ê¸° (ë¹Œë“œ ì‹œ ì£¼ì… ê°€ëŠ¥)
    // 2. ë°±ì—”ë“œ APIì—ì„œ ê°€ì ¸ì˜¤ê¸° (ë™ì  ì„¤ì •)
    let androidApkUrl = 'https://your-domain.com/downloads/labor-management.apk';
    let androidPlayStoreUrl = null;
    let iosAppStoreUrl = 'https://apps.apple.com/app/idYOUR_APP_ID';
    let iosTestFlightUrl = null;
    
    // ë©”íƒ€ íƒœê·¸ì—ì„œ ì½ê¸°
    const androidMeta = document.querySelector('meta[name="android-apk-url"]');
    const androidPlayStoreMeta = document.querySelector('meta[name="android-play-store-url"]');
    const iosMeta = document.querySelector('meta[name="ios-app-store-url"]');
    const iosTestFlightMeta = document.querySelector('meta[name="ios-testflight-url"]');
    
    if (androidMeta) {
      androidApkUrl = androidMeta.getAttribute('content') || androidApkUrl;
    }
    if (androidPlayStoreMeta) {
      androidPlayStoreUrl = androidPlayStoreMeta.getAttribute('content');
    }
    if (iosMeta) {
      iosAppStoreUrl = iosMeta.getAttribute('content') || iosAppStoreUrl;
    }
    if (iosTestFlightMeta) {
      iosTestFlightUrl = iosTestFlightMeta.getAttribute('content');
    }
    
    // ë°±ì—”ë“œ APIì—ì„œ ì•± ì„¤ì¹˜ ë§í¬ ê°€ì ¸ì˜¤ê¸° (ì„ íƒì‚¬í•­)
    // API URLì€ í™˜ê²½ ë³€ìˆ˜ ë˜ëŠ” ê¸°ë³¸ê°’ ì‚¬ìš©
    // ê°œë°œ í™˜ê²½: http://localhost:3000
    // í”„ë¡œë•ì…˜: ê°™ì€ origin ë˜ëŠ” í™˜ê²½ ë³€ìˆ˜ì—ì„œ ì„¤ì •
    const getApiBaseUrl = () => {
      // window ê°ì²´ì— ì„¤ì •ëœ API URL í™•ì¸ (ë¹Œë“œ ì‹œ ì£¼ì… ê°€ëŠ¥)
      if (typeof window !== 'undefined' && (window as any).API_BASE_URL) {
        return (window as any).API_BASE_URL;
      }
      // í˜„ì¬ í˜ì´ì§€ê°€ localhostì¸ ê²½ìš°
      if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        return 'http://localhost:3000';
      }
      // í”„ë¡œë•ì…˜: ê°™ì€ originì˜ API ì‚¬ìš© (ë°±ì—”ë“œê°€ ê°™ì€ ë„ë©”ì¸ì¸ ê²½ìš°)
      // ë˜ëŠ” í™˜ê²½ ë³€ìˆ˜ì—ì„œ ì„¤ì •
      return `${window.location.protocol}//${window.location.hostname}${window.location.port ? ':' + window.location.port : ''}`;
    };
    
    const apiBaseUrl = getApiBaseUrl();
    
    fetch(`${apiBaseUrl}/api/app-install-links`)
      .then(response => response.json())
      .then(data => {
        if (data.android?.apkUrl) androidApkUrl = data.android.apkUrl;
        if (data.android?.playStoreUrl) androidPlayStoreUrl = data.android.playStoreUrl;
        if (data.ios?.appStoreUrl) iosAppStoreUrl = data.ios.appStoreUrl;
        if (data.ios?.testFlightUrl) iosTestFlightUrl = data.ios.testFlightUrl;
        
        // ë§í¬ê°€ ì—…ë°ì´íŠ¸ë˜ë©´ ë²„íŠ¼ ë‹¤ì‹œ ìƒì„±
        updateInstallButtons();
      })
      .catch(error => {
        console.log('[App Install] API í˜¸ì¶œ ì‹¤íŒ¨, ë©”íƒ€ íƒœê·¸ ê°’ ì‚¬ìš©:', error);
        // API ì‹¤íŒ¨ ì‹œ ë©”íƒ€ íƒœê·¸ ê°’ ì‚¬ìš© (ì´ë¯¸ ì„¤ì •ë¨)
        createInstallButtons();
      });
    
    function updateInstallButtons() {
      const buttonGroup = document.querySelector('.button-group');
      if (!buttonGroup) return;
      
      // ê¸°ì¡´ ì„¤ì¹˜ ë²„íŠ¼ ì œê±°
      const existingButtons = buttonGroup.querySelectorAll('.install-btn');
      existingButtons.forEach(btn => btn.remove());
      
      // í”Œë«í¼ë³„ ì„¤ì¹˜ ë²„íŠ¼ ë‹¤ì‹œ ìƒì„±
      createInstallButtons();
    }
    
    const androidSteps = document.getElementById('androidSteps');
    const iosSteps = document.getElementById('iosSteps');
    
    function createInstallButtons() {
      const buttonGroup = document.querySelector('.button-group');
      if (!buttonGroup) return;
      
      if (isAndroid) {
        // Android: Play Store ìš°ì„ , ì—†ìœ¼ë©´ APK ë‹¤ìš´ë¡œë“œ
        if (androidPlayStoreUrl) {
          const playStoreBtn = document.createElement('a');
          playStoreBtn.className = 'btn btn-primary install-btn';
          playStoreBtn.textContent = 'Play Storeì—ì„œ ì„¤ì¹˜';
          playStoreBtn.href = androidPlayStoreUrl;
          playStoreBtn.target = '_blank';
          buttonGroup.insertBefore(playStoreBtn, buttonGroup.firstChild);
        } else if (androidApkUrl && androidApkUrl !== 'https://your-domain.com/downloads/labor-management.apk') {
          const apkBtn = document.createElement('a');
          apkBtn.className = 'btn btn-primary install-btn';
          apkBtn.textContent = 'Android ì•± ë‹¤ìš´ë¡œë“œ (APK)';
          apkBtn.href = androidApkUrl;
          apkBtn.target = '_blank';
          buttonGroup.insertBefore(apkBtn, buttonGroup.firstChild);
        }
        
        if (androidSteps) {
          androidSteps.style.display = 'block';
        }
        
        // ê¸°ì¡´ "ì•±ìœ¼ë¡œ ì´ë™í•˜ê¸°" ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        const appLink = document.getElementById('appLink');
        if (appLink) {
          appLink.style.display = 'none';
        }
      } else if (isIOS) {
        // iOS: TestFlight ìš°ì„ , ì—†ìœ¼ë©´ App Store
        if (iosTestFlightUrl) {
          const testFlightBtn = document.createElement('a');
          testFlightBtn.className = 'btn btn-primary install-btn';
          testFlightBtn.textContent = 'TestFlightì—ì„œ ì„¤ì¹˜';
          testFlightBtn.href = iosTestFlightUrl;
          testFlightBtn.target = '_blank';
          buttonGroup.insertBefore(testFlightBtn, buttonGroup.firstChild);
        } else if (iosAppStoreUrl && iosAppStoreUrl !== 'https://apps.apple.com/app/idYOUR_APP_ID') {
          const appStoreBtn = document.createElement('a');
          appStoreBtn.className = 'btn btn-primary install-btn';
          appStoreBtn.textContent = 'App Storeì—ì„œ ì„¤ì¹˜';
          appStoreBtn.href = iosAppStoreUrl;
          appStoreBtn.target = '_blank';
          buttonGroup.insertBefore(appStoreBtn, buttonGroup.firstChild);
        }
        
        if (iosSteps) {
          iosSteps.style.display = 'block';
        }
        
        // ê¸°ì¡´ "ì•±ìœ¼ë¡œ ì´ë™í•˜ê¸°" ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        const appLink = document.getElementById('appLink');
        if (appLink) {
          appLink.style.display = 'none';
        }
      }
    }
    
    // ì´ˆê¸° ì„¤ì¹˜ ë²„íŠ¼ ìƒì„± (ë©”íƒ€ íƒœê·¸ ê°’ ì‚¬ìš©)
    createInstallButtons();
    
    // ì•±ìœ¼ë¡œ ì´ë™ ë§í¬ ì—…ë°ì´íŠ¸ (ì„¤ì¹˜ ë²„íŠ¼ì´ ì—†ëŠ” ê²½ìš°ì—ë§Œ í‘œì‹œ)
    const appLink = document.getElementById('appLink');
    if (appLink && appLink.style.display !== 'none') {
      appLink.href = redirectPath;
    }

    // Capacitor ì•± ì„¤ì¹˜ í›„ ë³µê·€ ê°ì§€
    const checkAppInstalled = () => {
      if (window.Capacitor !== undefined) {
        window.location.href = redirectPath;
      }
    };

    // visibilitychange ì´ë²¤íŠ¸ë¡œ ì•± ì„¤ì¹˜ í›„ ë³µê·€ ê°ì§€
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden) {
        checkAppInstalled();
      }
    });

    // ì£¼ê¸°ì ìœ¼ë¡œ í™•ì¸ (iOSì—ì„œ ì•± ì„¤ì¹˜ í›„ ëŒì•„ì˜¬ ë•Œ)
    const checkInterval = setInterval(() => {
      if (window.Capacitor !== undefined) {
        clearInterval(checkInterval);
        window.location.href = redirectPath;
      }
    }, 1000);

    // 30ì´ˆ í›„ ì¸í„°ë²Œ ì¢…ë£Œ
    setTimeout(() => {
      clearInterval(checkInterval);
    }, 30000);
  </script>
</body>
</html>

