# 카카오톡 알림톡 설정 가이드

## 개요

근로계약서 발송 시 그레이트퍼즐 카카오톡 채널을 통해 근로자에게 계약서명 안내 메시지를 전송합니다.

## 카카오톡 알림톡 설정 방법

### 1. 카카오 비즈니스 계정 생성

1. [카카오 비즈니스](https://business.kakao.com/) 접속
2. 카카오 계정으로 로그인
3. 비즈니스 채널 생성 (그레이트퍼즐)

### 2. 알림톡 템플릿 등록

1. 카카오 비즈니스 콘솔 → **알림톡** 메뉴
2. **템플릿 만들기** 클릭
3. 템플릿 내용 작성:
   ```
   [그레이트퍼즐] 근로계약서가 발송되었습니다.

   {#근로자명}님, 근로계약서를 확인하고 서명해주세요.

   📋 계약서 확인하기
   {#계약서링크}

   📱 앱이 없으신가요?
   앱 설치하기
   {#앱설치링크}

   문의: 그레이트퍼즐 고객센터
   ```
4. 템플릿 승인 대기 (카카오 심사 필요, 보통 1-2일 소요)
5. 승인 후 템플릿 코드 확인

### 3. API 키 발급

1. 카카오 개발자 콘솔 접속: https://developers.kakao.com/
2. 내 애플리케이션 → 애플리케이션 추가하기
3. 앱 키 확인:
   - **REST API 키** (KAKAO_REST_API_KEY)
   - **알림톡 발신 프로필 키** (KAKAO_SENDER_KEY)

### 4. 환경 변수 설정

백엔드 `.env` 파일에 다음 변수 추가:

```env
# 카카오톡 알림톡 설정
KAKAO_REST_API_KEY=your-kakao-rest-api-key
KAKAO_SENDER_KEY=your-kakao-sender-key
KAKAO_ALIMTALK_TEMPLATE_CODE=your-template-code
KAKAO_CHANNEL_ID=your-channel-id

# 모바일 앱 URL
MOBILE_APP_URL=http://localhost:5174
# 프로덕션: https://your-mobile-app-domain.com
```

## 알림톡 메시지 형식

### 메시지 내용

```
[그레이트퍼즐] 근로계약서가 발송되었습니다.

{근로자명}님, 근로계약서를 확인하고 서명해주세요.

📋 계약서 확인하기
{계약서링크}

문의: 그레이트퍼즐 고객센터
```

### 링크 정보

- **계약서 링크**: `{MOBILE_APP_URL}/contract/{contractId}`
  - 근로자가 계약서를 확인하고 서명할 수 있는 링크
  - **자동 앱 설치 감지**: 앱이 설치되어 있지 않은 경우, 자동으로 설치 안내 페이지(`/download.html?redirect=/contract/{contractId}`)로 리다이렉트됩니다.
  - 앱 설치 후 원래 계약서 링크로 자동 이동합니다.

### 버튼 구성

- **"계약서 확인하기" 버튼 하나만 제공**
  - 앱 설치 여부를 자동으로 판별하여 처리
  - 앱이 없으면 설치 페이지로 자동 리다이렉트
  - "앱이 없나요?" 같은 별도 질문 없이 자동 처리

## 개발 모드

환경 변수가 설정되지 않은 경우:
- 개발 모드로 동작
- 카카오톡 메시지는 전송되지 않음
- 로그에 메시지 내용 출력
- 계약서 발송은 정상적으로 진행됨

## 테스트 방법

### 1. 개발 모드 테스트

환경 변수를 설정하지 않고 테스트:
- 계약서 발송 시 로그에 메시지 내용 출력
- 실제 카카오톡 메시지는 전송되지 않음

### 2. 실제 API 테스트

1. 환경 변수 설정
2. 카카오 비즈니스 계정에 테스트 전화번호 등록
3. 계약서 발송
4. 카카오톡 메시지 수신 확인

## 주의사항

1. **알림톡 템플릿 승인**: 템플릿은 카카오 심사를 거쳐야 사용 가능
2. **전화번호 형식**: 전화번호는 하이픈 없이 숫자만 사용 (예: 01012345678)
3. **발송 제한**: 카카오톡 알림톡은 일일 발송량 제한이 있을 수 있음
4. **에러 처리**: API 호출 실패 시에도 계약서 발송은 성공으로 처리됨

## 문제 해결

### 알림톡이 전송되지 않는 경우

1. 환경 변수 확인
2. 카카오 비즈니스 콘솔에서 템플릿 상태 확인
3. 전화번호 형식 확인 (하이픈 제거)
4. 백엔드 로그 확인

### API 오류 발생 시

- 에러가 발생해도 계약서 발송은 정상적으로 완료됨
- 근로자는 계약서 링크를 직접 접속하여 확인 가능
- 로그에서 오류 원인 확인

