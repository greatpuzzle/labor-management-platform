# 배포 문제 원인 분석

## 가능한 원인

프론트엔드 배포가 제대로 안 되는 이유:

### 1. 파일명 변경 문제 (가장 가능성 높음)

Vite는 빌드할 때 파일명에 해시를 포함합니다 (예: `index-DR49-q9s.js`).
- 새로운 빌드를 하면 파일명이 변경됩니다
- 하지만 배포 후에도 이전 파일명의 파일이 남아있을 수 있습니다
- 브라우저가 HTML에서 참조하는 파일명과 실제 파일명이 다를 수 있습니다

### 2. HTML 파일이 업데이트되지 않음

`index.html` 파일도 함께 배포되어야 하는데:
- HTML 파일이 업데이트되지 않으면 이전 JavaScript 파일을 참조할 수 있습니다
- 또는 배포 경로 문제로 HTML과 JavaScript 파일이 일치하지 않을 수 있습니다

### 3. 배포 경로 문제

`scp -r apps/admin/dist/* ubuntu@$EC2_IP:~/app/admin/`는:
- `dist/*`의 내용을 `~/app/admin/`에 복사합니다
- 하지만 기존 파일이 완전히 삭제되지 않을 수 있습니다

### 4. 브라우저 캐시

브라우저가 이전 JavaScript 파일을 캐시하고 있을 수 있습니다:
- 시크릿 모드에서도 문제가 있다면 서버 문제입니다
- 시크릿 모드에서 정상이면 브라우저 캐시 문제입니다

### 5. 서빙 프로세스 문제

포트 3000에서 Admin 웹을 서빙하는 프로세스가:
- 이전 파일을 캐시하고 있을 수 있습니다
- 또는 다른 경로의 파일을 서빙하고 있을 수 있습니다

## 확인 방법

```bash
./analyze-deployment-issue.sh
```

이 스크립트는:
1. 로컬 빌드 확인
2. 배포된 파일 확인
3. 파일명 비교
4. 파일 크기 비교
5. 배포된 파일 내용 확인
6. 모든 JavaScript 파일 확인
7. 포트 3000 사용 프로세스 확인

## 해결 방법

### 1. 기존 파일 완전 삭제 후 배포

```bash
ssh -i "$SSH_KEY_PATH" ubuntu@$EC2_IP "rm -rf /home/ubuntu/app/admin/*"
scp -i "$SSH_KEY_PATH" -r apps/admin/dist/* ubuntu@$EC2_IP:~/app/admin/
```

### 2. 파일명 확인

배포 후 HTML 파일에서 참조하는 JavaScript 파일명과 실제 파일명이 일치하는지 확인

### 3. 서빙 프로세스 재시작

포트 3000에서 Admin 웹을 서빙하는 프로세스를 재시작
